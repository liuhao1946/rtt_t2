
## 简介

RTT_T2是一个免费、易用的多功能调试工具，它将很好的替代我之前做的[RTT-T](https://gitee.com/bds123/RTT-T)。它具有如下特点：

* 可选RTT通信，部分性能优于J_Link RTT Viewer。

* 可选串口通信，方便不使用RTT的工程师适用。

* 绘制具有良好交互性的动态波形图，最多支持同时绘制3条曲线。

* 支持log字符串过滤，方便你过滤掉你不感兴趣的字符串。

* 支持MCU端发送的**中文字符**。

* 支持以多种颜色显示log。

* 支持多行发送，方便发送各种字符串以及十六进制数据。

* 数据显示区内的数据不会自动清除。

* 数据显示区支持暂停在当前页面但不影响后续数据接收。

* 一键保存数据显示区的全部数据。

---可能是两个动图，一个log显示，一个波形显示器

---
## 使用指南
#### 软件的界面构成
主界面

配置界面

#### RTT(J_Link)通信

1. 点击主界面**配置**按钮。

2. 选择你的MCU、J_Link通信速度。

3. 根据需要勾选连接MCU时是否复位MCU。

4. 点击保存按钮，退出配置界面。

5. 在主界面上点击**J_Link连接**按钮。

> Note:
> 1. 使用RTT时，需要安装官方的[J_Link](https://www.segger.com/downloads/jlink/)组件。否则会因为RTT_T2无法调用J_Link的静态库而无法使用。
> 2. 对于工具不支持的芯片型号，参考[添加芯片](使用J_Link时，如何添加RTT_T2不支持的芯片型号？)
> 3. **RTT目前只支持0通道，不支持其他通道**。这意味着你只能调用SEGGER_RTT_printf(0, "test\n")发送数据，而不能调用SEGGER_RTT_printf(1,"test\n")去发送数据。

#### 串口通信

1. 点击主界面的**配置**按钮。

2. 选择COM口、波特率。

3. 点击保存按钮，退出配置界面。

4. 在主界面上点击**串口连接**按钮。

> Note: 
> 1. 目前只支持接收**字符格式**数据。
> 2. 如果要发送十六进制数据，请在MCU端将HEX数据转换为字符串后再发送到工具。

#### 显示中文字体
1. 将你的编辑器（keil、vs、IAR等）编码格式设置为**UTF-8**格式。

2. 点击主界面的**配置**按钮。

3. 在编码格式的栏位中，选中utf-8。此时，工具将使用uft-8解码从MCU发送的中文字符。

> Note:
>1. 工具默认选择的编码格式是**asc**，这也是我推荐的格式。因为工具使用该格式时，处理效率更高。
>2. 如果对中文字符显示有需求，你的数据不要**一直**以超过100Hz(10ms)的频率发送log数据。否则会造成工具无法显示或者及时显示你发过来的log，以**asc**格式发送则没有限制。

#### 发送带有颜色的字体
发送的数据在rtt_t中显示什么颜色由MCU端决定，以RTT为例，串口类似：
```c
#define BDS_COLOR_TAG           "BDSCOL"

#define BDS_LOG_COLOR_BLACK     0x000000
#define BDS_LOG_COLOR_RED       0xFF3030
#define BDS_LOG_COLOR_GREEN     0x008B00
#define BDS_LOG_COLOR_BLUE      0x00008B
#define BDS_LOG_COLOR_VIOLET    0x9932CC

char *s = "test\n";

//红色
SEGGER_RTT_printf(0, BDS_COLOR_TAG "(%d)%s", BDS_LOG_COLOR_RED, s);
//绿色
SEGGER_RTT_printf(0, BDS_COLOR_TAG "(%d)%s", BDS_LOG_COLOR_GREEN, s);
//黑色
SEGGER_RTT_printf(0, BDS_COLOR_TAG "(%d)%s", BDS_LOG_COLOR_BLACK, s);
//黑色。不带BDS_COLOR_TAG标签时，rtt_t按照默认按照黑色显示
SEGGER_RTT_printf(0,"%s", s);
//蓝色
SEGGER_RTT_printf(0, BDS_COLOR_TAG "(%d)%s", BDS_LOG_COLOR_BLUE, s);
//紫色
SEGGER_RTT_printf(0, BDS_COLOR_TAG "(%d)%s", BDS_LOG_COLOR_VIOLET, s);
```

要注意的是，同一行的log显示的是同一个颜色，不同行中如果采用了不同的RGB色，在rtt_t中显示的颜色是不一样的。另外，由于采用的是RGB色，你可以将你的log以**任何颜色**显示在rtt_t中，而不仅仅限于例子中的几个颜色。

能被rtt_t识别的颜色标签格式必须是: **BDS_COLOR_TAG(xxx)zzz\n**，xxx为颜色值，zzz为你自己的字符串。

----图片

#### 配置过滤项目
1. 打开主界面上的**过滤**选项。

2. 输入你需要过滤的字符串。如果需要过滤多个不同的字符串，不同的字符串间以&&隔开。比如你需要过滤包含TAG=DLOG以及TAG=BDS的行，你的过滤表达式应该这么写:
    > TAG=DLOG&&TAG=BDS

    此时，rtt_t将过滤掉所有包含TAG=DLOG以及TAG=BDS的行。

> Note:
    对于你设置的需要过滤的字符串，其字符串长度应该≥3，否则可能产生误过滤，这一点是显而易见的。


#### 波形显示
波形显示可以用来研究数据的变化，帮助工程师寻找数据的规律以设计自己的算法。要利用这个功能，除了rtt_t提供的波形显示器以外，还需要MCU端配合。

##### 波形显示器

* 可配置y轴的默认范围，y轴的轴名称，以及3条曲线的名称。
    > 打开配置对话框，按照需要设置波形的默认参数。注意，如果你只需要绘制一条曲线，只需要设置X轴的轴名称，如果需要绘制两条曲线，则需要设置X、Y轴的轴名称。

* 使用鼠标滚轮控制y轴的尺度，方便观察细节以及动态调整y轴范围。

* 存在多条曲线时，可以隐藏不需要观察的波形。
    > 鼠标右键 → 隐藏波形 

* 可选的x轴(时间轴)可视范围，默认10s。以方便观察波形细节。
    > 鼠标右键 → x轴可视范围 

* 打开统计功能，它将统计你标记的区域内的几条曲线的统计参数。包括最大值、最小值、平均值、标准差。
    > 鼠标右键 → 打开统计区域

* 暂停实时波形，以观察当前波形特征。
    > 鼠标右键 → 暂停

* 拖拽实时波形，观察历史数据的同时不影响实时接收的数据。注意的是，波形只支持6分钟的数据回溯，这样设计是为了节省内存，不过，如果有需求，这一点可以在后续的软件版本中修改。
    > 点击鼠标左键不放，向左或者向右拖拽波形

* 导出x轴(时间轴)可视范围内的全部数据。
    > Export... → 导出格式选择CSV → Export

* 一键回到波形最前端。该功能方便历史波形数据回溯时快速的跟踪当前波形的最新状态。
    > 鼠标右键 → 回到波形最前端
  

##### MCU向波形显示器发送数据
要想波形显示器能正常工作，MCU端向rtt_t发送log时需要满足一定的数据格式。标准的数据格式如下：
如果发送整形数据：
> TAG=DLOG INT(x,y,z)\n

上述的字符串中，TAG=DLOG表示log标签，INT表示括号内的数据为整形数，最后附带一个换行符。

x、y、z表示你要发送的数据

在MCU端，你的发送接口(以RTT为例，串口类似)如下：
```c
int16_t ax,ay,az;
static uint32_t sn = 0;

SEGGER_RTT_printf(0,  BDS_CWM_COLOR_TAG"(%d)TAG=DLOG SN(%d)INT(%d,%d,%d)\n", BDS_LOG_COLOR_RED, sn++, ax, ay, az);
```
如果发送浮点数:
> TAG=DLOG FLOAT(x,y,z)\n

上述的字符串中，TAG=DLOG表示log标签，FLOAT表示括号内的数据为浮点，最后附带一个换行符。

在MCU端，你的发送接口(以RTT为例，串口类似)如下：
```c
float gx,gy,gz;
static uint32_t sn = 0;

SEGGER_RTT_printf(0,  BDS_CWM_COLOR_TAG"(%d)TAG=DLOG SN(%d)FLOAT(%0.3f,%0.3f,%0.3f)\n", BDS_LOG_COLOR_RED, sn++, gx, gy, gz);
```

---

## FAQ
#### 使用J_Link时，如何添加RTT-T2不支持的芯片型号？
请参考[RTT-T](https://gitee.com/bds123/RTT-T)仓库的**RTT-T配置**部分。

#### 如果你选择的芯片不能被RTT-T2识别怎么办？
有时候你已经正确的获得了你的芯片在J_Link中的命名，但当你尝试使用RTT-T2去连接芯片时要么不成功，要么无法进行RTT通信，这个时候你可以将芯片选择为**nRF52840xxAA**后在尝试。

#### 如何更高效的利用保存全部保存功能？
由于点击**保存全部数据**按钮完成了两件事，一件将RTT-T2的数据区内的log全部保存到txt文本。另一件是打开这个txt文本。所以如果你将**txt文本的默认打开程序设置为notepad或者vs**，你可以在一个非常强大的编辑器中搜索、编辑log。这也是为什么RTT-T2没有做log检索功能的一个原因。

---

## 写在最后
本项目是免费使用的，之所以这么做是因为我个人受益于开源，因此对于开源事业做一点微薄贡献一直是我很想做的事情之一。对我而言，可能更重要的想在这个世界留下一点痕迹，当有人受益于此，我便十分欣慰。假如你想表达感谢，请点个Star，你的Star就是我前进的动力。



